{% extends "base.html" %}


  <title>{% block title %}Teacher page{% endblock %}</title>

{% block content %}
<div class="container">
  <div class="row">
    <div class="col-md-6">
      <div id="pieChartContainer">
        <canvas id="pieChart"></canvas>
      </div>
      <p class="text-center mt-2">Points Remaining: {{ current_user.remaining_points }}</p>
    </div>
    <div class="col-md-6">
      <div class="form-group">
        <label for="filter">Select a class or year group:</label>
        <select id="filter">
          <option value="all">All</option>
          {% for year_group in year_groups %}
            <option value="{{ year_group }}">{{ year_group }}</option>
          {% endfor %}
          {% for class_name in class_names %}
            <option value="{{ class_name }}">{{ class_name }}</option>
          {% endfor %}
        </select>
      </div>
      <div id="barChartContainer">
        <canvas id="barChart"></canvas>
      </div>
    </div>
  </div>
</div>


<script>
  var ctx = document.getElementById('pieChart').getContext('2d');
  var myChart = new Chart(ctx, {
      type: 'pie',
      data: {
          labels: ['Points Awarded', 'Points Remaining'],
          datasets: [{
              label: 'Points',
              data: [{{ current_user.points_awarded }}, {{ current_user.remaining_points }}],
              backgroundColor: [
                  'rgba(255, 99, 132, 0.2)',
                  'rgba(54, 162, 235, 0.2)'
              ],
              borderColor: [
                  'rgba(255, 99, 132, 1)',
                  'rgba(54, 162, 235, 1)'
              ],
              borderWidth: 1
          }]
      },
      options: {
          responsive: true,
          maintainAspectRatio: false
      }
  });
  </script>

<script>
  var classes;
  {% if classes %}
  classes = JSON.parse('{{ classes | tojson | safe }}');
  {% else %}
  classes = [];
  {% endif %}

  function filterData(data, filterValue) {
    if (filterValue === 'all') {
      return data;
    } else {
      return data.filter(function(d) {
        return d.year_group === filterValue || d.name === filterValue;
      });
    }
  }

  function createBarChart(filterValue) {
  var filteredData = filterData(classes, filterValue);
  var ctx = document.getElementById('barChart').getContext('2d');
  var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: filteredData.map(function(d) { return d.name; }),
      datasets: [{
        label: 'Points Awarded',
        data: filteredData.map(function(d) { return d.points_awarded; }),
        backgroundColor: 'rgba(255, 99, 132, 0.2)',
        borderColor: 'rgba(255, 99, 132, 1)',
        borderWidth: 1
      }, {
        label: 'Points Remaining',
        data: filteredData.map(function(d) { return d.remaining_points; }),
        backgroundColor: 'rgba(54, 162, 235, 0.2)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        yAxes: [{
          ticks: {
            beginAtZero: true
          }
        }]
      }
    }
  });
}


  createBarChart('all');

  document.getElementById('filter').addEventListener('change', function() {
    var filterValue = this.value;
    var ctx = document.getElementById('barChart').getContext('2d');
    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
    createBarChart(filterValue);
  });
</script>

    
{% endblock %}
